# í†µì‹ Data CollectionViewCell imageì²˜ë¦¬ + CoreData í†ºì•„ë³´ê¸°

***

* Carousel íš¨ê³¼ë¥¼ ì¤€ Custom CollectionViewë¥¼ ë§Œë“¬
* Cellì„ xibë¡œ ì»¤ìŠ¤í…€í•´ì„œ í†µì‹ ë°›ì€ imgURLë¡œ ì´ë¯¸ì§€ ì²˜ë¦¬í•¨ But ë¬¸ì œë°œìƒ

```swift
let soldierDataTask: URLSessionDataTask = session.dataTask(with: URL(string: APIConstants.soldierURL)!){ (data: Data?, response: URLResponse?, error: Error?) in
            
            if let error = error {
                print(error.localizedDescription)
                return
            }
            guard let data = data else { return }
            
            do {
                let apiResponse: SoldierModel = try JSONDecoder().decode(SoldierModel.self, from: data)
                
                self.soldiers = apiResponse.data
              
                DispatchQueue.main.async {
                    
                    self.pagingCollectionView.reloadData()
                 
                }
                
                
            }catch(let err){
                print(err.localizedDescription)
            }
            
        }
        
        soldierDataTask.resume()
```

* ìœ„ì™€ê°™ì´ í†µì‹ ì„ ViewDidAppear()ì—ì„œ ì²˜ë¦¬ ë””ìŠ¤íŒ¨ì¹˜íë¥¼ í†µí•´ ë©”ì¸ì—ì„œ reloadData( )

```swift
DispatchQueue.global().async {
guard let imageURL = URL(string: self.soldiers[indexPath.row].soldierprofile) else  {
                return
        }
            guard let imageData: Data = try? Data(contentsOf: imageURL) else {
                return
            }
            
            DispatchQueue.main.async {
//                if let index: IndexPath = self.pagingCollectionView.indexPath(for: cell){
//                    if index.row == indexPath.row{
                        
                        cell.soldierProfileImageView.image = UIImage(data: imageData)
                        
//                    }else{
//                        cell.soldierProfileImageView.image = UIImage(named: "mainBtnMail")
//
//                    }
//                }
            }
        }
```

* cellForItemAt ë©”ì†Œë“œì—ì„œ ë‹¤ìŒê³¼ ê°™ì€ ì½”ë“œë¥¼ ì‹¤í–‰
* TableView, CollectionView ì—ì„œë„ ì…€ì„ ì¬í™œìš©í•˜ê¸° ë•Œë¬¸ì— indexPathê°’ì— ë§ëŠ” ë°ì´í„°ì™€ ì´ë¯¸ì§€ë¥¼ ë„£ì–´ì¤˜ì•¼ ì¬í™œìš© í›„ì—ë„ ë°ì´í„°ê°€ ë’¤ë°”ë€Œì§€ ì•ŠìŒ
* ê·¸ë˜ì„œ if let index ë¶€ë¶„ê³¼ if index.row == indexPath.row ë¶€ë¶„ì´ í•„ìš” [ë‚´ê°€ë³´ëŠ” indexPathê°’ê³¼ ë°ì´í„°ì²˜ë¦¬ì˜ indexPathê°’ì„ ë™ê¸°í™”]
* But , ì£¼ì„ë¶€ë¶„ì„ í¬í•¨í•œ ì½”ë“œë¡œ ì‹¤í–‰ì‹œ ì´ë¯¸ì§€ê°€ 1,2ë²ˆì§¸ ì…€ì—ë§Œ ë“¤ì–´ê°€ê²Œ ë˜ëŠ” ë²„ê·¸ ë°œìƒ [prepareForReuse()ë„ ì‚¬ìš©í–ˆìœ¼ë‚˜ ê°™ì€ ë²„ê·¸ ê³„ì† ë°œìƒ]
* ë©”ì¸ì—ì„œ indexPathë¶€ë¶„ì„ ì§€ìš°ë©´ ì •ìƒì ìœ¼ë¡œ ë°ì´í„° ì²˜ë¦¬ê°€ ë˜ì–´ì§

#### Why?

* ì´ë¯¸ì§€í¬ê¸°ê°€ ì»¤ì§€ë©´(ê¸°ì¤€ì€ ëª¨í˜¸í•¨) ë¡œë”©ì— ì‹œê°„ì´ ê±¸ë¦¬ê¸° ë•Œë¬¸ì— indexPathê°’ì„ ë§ê²Œ ë„£ì–´ì¤˜ì•¼ í•˜ì§€ë§Œ ì§€ê¸ˆì€ ì´ë¯¸ì§€ì˜ í¬ê¸°ê°€ ì‘ì•„ì„œ(2ë©”ê°€ë°”ì´íŠ¸ ë¯¸ë§Œ) ì…€ê³¼ ë°ì´í„°ë¥¼ ë¡œë”©í•˜ëŠ”ë° ë§¤ìš° ë¹ ë¥´ê¸° ë•Œë¬¸ì— ì˜¤íˆë ¤ indexPathë¥¼ ë§ì¶°ì£¼ëŠ” ì‘ì—…ì„ í•˜ë©´ ë°ì´í„°ê°€ ë§ê²Œ ë“¤ì–´ê°€ì§€ì§€ê°€ ì•ŠìŒ
* ì¦‰, ì´ë¯¸ì§€ìºì‹±ê³¼ ë°ì´í„° ê·¸ë¦¬ê³  ì…€ì˜ indexPath ì¬ì‚¬ìš© ë™ê¸°í™”ë¬¸ì œë¼ê³  ë³¼ ìˆ˜ ìˆìŒ

#### í‚¹í”¼ì…”ì“°ëŠ”ê²Œ í¸í•  ìˆ˜ë„?(í‚¹í”¼ì…”ë¡œ ì´ë¯¸ì§€ ì²˜ë¦¬ì‹œ ë¬¸ì œê°€ í•´ê²°ë ì§€ ëª¨ë¥´ê² ìŒ ì‹œê°„ë‚´ì–´ì„œ í•´ë³´ê¸°ë¡œ!) ë˜í•œ ë°ì´í„°ì˜ ì´ë¯¸ì§€ ì²˜ë¦¬ë¥¼ ì…€ë¡œ ë„˜ê²¨ì¤˜ì„œ ì…€ì—ì„œ ì²˜ë¦¬ì‹œí‚¤ëŠ” ë°©ë²•ìœ¼ë¡œë„ í•´ê²° ê°€ëŠ¥í•´ ë³´ì„

***

### CoreData             [ì°¸ê³ ìë£Œ](https://medium.com/@hanulyun88/swift-coredataë¡œ-ë°ì´í„°-ì €ì¥-ë°-ê´€ë¦¬í•˜ê¸°-19f61c95232f)

<img width="767" alt="ìŠ¤í¬ë¦°ìƒ· 2020-06-12 ì˜¤í›„ 1 28 52" src="https://user-images.githubusercontent.com/55793344/84464932-c35b8d00-acb0-11ea-9b41-31ae558ca16f.png">

* Projectì¤‘ê°„ì— CoreDataì‚¬ìš©ì„ ìœ„í•´ì„œ Data Model ìƒì„±

<img width="248" alt="ìŠ¤í¬ë¦°ìƒ· 2020-06-12 ì˜¤í›„ 1 29 10" src="https://user-images.githubusercontent.com/55793344/84464937-c5bde700-acb0-11ea-8935-5c29860d7a5c.png">

* Codegen -> Manual/None ìœ¼ë¡œ í•„ìˆ˜ë¡œ ë°”ê¿”ì¤˜ì•¼í•¨ , ì„œë¸Œí´ë˜ìŠ¤ê°€ ë‚¨ì•„ ìˆì–´ì„œ ëˆˆì— ë³´ì´ì§€ ì•ŠëŠ” ì—ëŸ¬ì™€ ì¶©ëŒ ë°œìƒ

* CoreData Modelì— ì›í•˜ëŠ” id, Devices ë“± ë°ì´í„°ì˜ ëª¨ë¸ ìƒì„± String, int64 ë“±ë“±

***

#### CoreDataì‚¬ìš©ì„ ìœ„í•œ í•µì‹¬!! AppDelegateì— í•´ë‹¹ ì½”ë“œ ì¶”ê°€!! [ì•ˆí•˜ë©´ ì‘ë™ ë¶ˆê°€]

```swift
class AppDelegate: UIResponder, UIApplicationDelegate {

    // MARK: - CoreData
    lazy var persistentContainer: NSPersistentContainer = {
        let container = NSPersistentContainer(name: "Users") // íŒŒì¼ëª… ì ê¸°(CoreDataModel)
        container.loadPersistentStores(completionHandler: { (storeDescription, error) in
            if let error = error {
                fatalError("Unresolved error, \((error as NSError).userInfo)")
            }
        })
        return container
    }()
```

* CoreDataë¥¼ ì•±ì˜ ë©”ì¸ ì»¨í…Œì´ë„ˆì— ë¶ˆëŸ¬ì˜¤ëŠ” ì‘ì—…ì´ë¼ ìƒê°ë¨ (ì½”ì–´ë°ì´í„°ê°€ ë¡œë“œë˜ì§€ ì•Šìœ¼ë©´ ë‹¹ì—°íˆ ì“¸ ìˆ˜ ì—†ë‹¤!_!)

```swift
class CoreDataManager {
    static let shared: CoreDataManager = CoreDataManager()
    
    let appDelegate: AppDelegate? = UIApplication.shared.delegate as? AppDelegate
    lazy var context = appDelegate?.persistentContainer.viewContext
    
    let modelName: String = "Users"
    
    func getUsers(ascending: Bool = false) -> [Users] {
        var models: [Users] = [Users]()
        
        if let context = context {
            let idSort: NSSortDescriptor = NSSortDescriptor(key: "id", ascending: ascending)
            let fetchRequest: NSFetchRequest<NSManagedObject>
                = NSFetchRequest<NSManagedObject>(entityName: modelName)
            fetchRequest.sortDescriptors = [idSort]
            
            do {
                if let fetchResult: [Users] = try context.fetch(fetchRequest) as? [Users] {
                    models = fetchResult
                }
            } catch let error as NSError {
                print("Could not fetchğŸ¥º: \(error), \(error.userInfo)")
            }
        }
        return models
    }
}
```

* CoreDataManagerë¥¼ ë§Œë“¤ì–´ì„œ contextë¥¼ í†µí•œ ì ‘ê·¼(ì§ì ‘ì ì¸ ì ‘ê·¼ì´ ì•„ë‹Œ ê°„ì ‘ì ‘ê·¼ìœ¼ë¡œ ë”ìš± ì•ˆì „í•œê²Œ ë°ì´í„° ê´€ë¦¬)ì„ í•´ì£¼ëŠ” í´ë˜ìŠ¤ ìƒì„±
* get,save,delete ë©”ì†Œë“œë¥¼ ë§Œë“¤ê³  ì´ë¥¼ í†µí•´ ì¤‘ê°„ì˜ ë°ì´í„° ëª¨ë¸ ê°’ì„ ìˆ˜ì •í•˜ëŠ” ì‘ì—…ë„ êµ¬í˜„ ê°€ëŠ¥

***

* MainViewControllerì—ì„œ ë‹¤ìŒê³¼ ê°™ì€ ì½”ë“œë¡œ ì‚¬ìš© ê°€ëŠ¥

```swift
 fileprivate func saveNewUser(_ id: Int64, name: String) {
        CoreDataManager.shared
            .saveUser(id: id, name: name, age: 16, date: Date(),
                      devices: [Devices.iMac.rawValue, Devices.iPad.rawValue]) { onSuccess in
                        print("saved = \(onSuccess)")
        }
    }
//ì‚¬ìš©ìë“±ë¡ì„ í•˜ëŠ” Actionê³¼ ë¶™ì—¬ì„œ ì‚¬ìš©
```

